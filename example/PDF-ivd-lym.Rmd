---
title: 'Example:IVD and Lymnode'
author: "Yi"
date: "`r format(Sys.Date())`"
output:
  pdf_document:
  html_document:
editor_options:
  chunk_output_type: console
classoption: landscape
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, error = TRUE, message=FALSE, comment="", 
                      fig.width = 12, fig.height = 6)
options(knitr.kable.NA = '.')
library(knitr)
library(kableExtra)
library(latex2exp)
library(dtametasa)
```



# IVD

```{r}
load("RData/IVD-est.RData")


setEPS(width = 12, height = 6)
postscript("ivd.eps")

par(mfrow =c(2,4))

col <- gray.colors(10, gamma = 1, start = 0, end = 0.8)

pts <- c(2,4,6,8)

sROC.matrix(est2[c(1,2,4,5),  pts])
legend("bottomright", 
       bty='n',
       legend = c(TeX(paste0("$p = 0.9, \\, \\tilde{c}_1^2 =", round(est2[6,2],3), 
                             ",\\, \\tilde{c}_2^2 = ", round(est2[7,2],3), "$")), 
                  TeX(paste0("$p = 0.7, \\, \\tilde{c}_1^2 =", round(est2[6,4],3), 
                             ",\\, \\tilde{c}_2^2 = ", round(est2[7,4],3), "$")), 
                  TeX(paste0("$p = 0.5, \\, \\tilde{c}_1^2 =", round(est2[6,6],3), 
                             ",\\, \\tilde{c}_2^2 = ", round(est2[7,6],3), "$")), 
                  TeX(paste0("$p = 0.3, \\, \\tilde{c}_1^2 =", round(est2[6,8],3), 
                             ",\\, \\tilde{c}_2^2 = ", round(est2[7,8],3), "$"))
                  ), 
       col = col[pts], pch = 18, pt.cex = 2,
       lty = rep(1,4))
title("A", adj = 0)
            

sROC.matrix(est11[c(1,2,4,5), pts])
legend("bottomright", 
       bty='n',
       legend = c(TeX("$p = 0.9, \\, c_1^2 = c_2^2$"), 
                  TeX("$p = 0.7, \\, c_1^2 = c_2^2$"), 
                  TeX("$p = 0.5, \\, c_1^2 = c_2^2$"), 
                  TeX("$p = 0.3, \\, c_1^2 = c_2^2$")), 
       col = col[pts], pch = 18, pt.cex = 2,
       lty = rep(1,4))
title("B", adj = 0)

sROC.matrix(est10[c(1,2,4,5), pts])
legend("bottomright", 
       bty='n',
       legend = c(TeX("$p = 0.9, \\, c_1^2 = 1, \\, c_2^2 = 0$"), 
                  TeX("$p = 0.7, \\, c_1^2 = 1, \\, c_2^2 = 0$"), 
                  TeX("$p = 0.5, \\, c_1^2 = 1, \\, c_2^2 = 0$"), 
                  TeX("$p = 0.3, \\, c_1^2 = 1, \\, c_2^2 = 0$")), 
       col = col[pts], pch = 18, pt.cex = 2,
       lty = rep(1,4))
title("C", adj = 0)


sROC.matrix(est01[c(1,2,4,5),pts])
legend("bottomright", 
       bty='n',
       legend = c(TeX("$p = 0.9, \\, c_1^2 = 0, \\, c_2^2 = 1$"), 
                  TeX("$p = 0.7, \\, c_1^2 = 0, \\, c_2^2 = 1$"), 
                  TeX("$p = 0.5, \\, c_1^2 = 0, \\, c_2^2 = 1$"), 
                  TeX("$p = 0.3, \\, c_1^2 = 0, \\, c_2^2 = 1$")), 
       col = col[pts], pch = 18,pt.cex = 2, 
       lty = rep(1,4))
title("D", adj = 0)

SAUC2   <- est2[c(10, 13, 14),]
SAUC11  <- est11[c(10, 13, 14),]
SAUC10  <- est10[c(10, 13, 14),]
SAUC01  <- est01[c(10, 13, 14),]


matplot(t(SAUC2), type = "o", lty = c(1,1,1), 
        pch = 19, col = c("black", "grey", "grey"),
        cex = 0.5,
        xlab = "p", ylab = "SAUC",
        ylim = c(0,1),
        xaxt = "n")
axis(1, at = 1:10, labels = p.seq)
title("E", adj = 0)



matplot(t(SAUC11), type = "o", lty = c(1,1,1), 
        pch = 19, col = c("black", "grey", "grey"),
        cex = 0.5,
        xlab = "p", ylab = "SAUC",
        ylim = c(0,1),
        xaxt = "n")
axis(1, at = 1:10, labels = p.seq)
title("F", adj = 0)

matplot(t(SAUC10), type = "o", lty = c(1,1,1), 
        pch = 19, col = c("black", "grey", "grey"),
        cex = 0.5,
        xlab = "p", ylab = "SAUC",
        ylim = c(0,1),
        xaxt = "n")
axis(1, at = 1:10, labels = p.seq)
title("G", adj = 0)

matplot(t(SAUC01), type = "o", lty = c(1,1,1), 
        pch = 19, col = c("black", "grey", "grey"),
        cex = 0.5,
        xlab = "p", ylab = "SAUC",
        ylim = c(0,1),
        xaxt = "n")
axis(1, at = 1:10, labels = p.seq)
title("H", adj = 0)


par(mfrow = c(1,1))

dev.off()
```

\newpage 

### Estimates

```{r}

load("RData/IVD-est.RData")

reform.est <- function(est){
  
colnames(est) <- paste0("p = ", p.seq)
rownames(est)[13:14] <- c("SAUC.ci.lb", "SAUC.ci.ub")

row.n <- c(10, 13,14, 11, 12)
tb <- t(est)

SAUC <- sprintf("%.3f [%.3f, %.3f]", tb[,10],tb[,13], tb[,14]) 
c    <- tb[,6:7]
sep  <- tb[,11:12]

cbind.data.frame(SAUC, c, sep)
}

tb2  <- reform.est(est2)
tb11 <- reform.est(est11)
tb10 <- reform.est(est10)
tb01 <- reform.est(est01)

tb <- cbind(p.seq, tb2, tb11, tb10, tb01)[, -c(8:9, 13:14, 18:19)]

colnames(tb) <- c("p", "SAUC [$95\\%$ CI]", "$c_1^2$", "$c_2^2$", "se", "sp", 
                  rep(c("SAUC [$95\\%$ CI]", "se", "sp"),3))
rownames(tb) <- NULL

sink("tb-ivd.tex")
kbl(tb, 
    format = "latex",
    longtable = F, 
    booktabs = T, 
    digits =2 ,
    align = "r",
    linesep = "",
    escape = FALSE,
    caption = "IVD") %>% 
  add_header_above(c(" ", "Estimated $c_1^2, c_2^2$" = 5, 
                     "$c_1^2 = c_2^2$" = 3, 
                     "$c_1^2 = 1, c_2^2 = 0$" = 3, 
                     "$c_1^2 = 0, c_2^2 = 1$" = 3), escape = FALSE)

sink()
```



# Lym




```{r}
## Prepare data
load("RData/Lym-est.RData")


setEPS(width = 12, height = 6)
postscript("lym.eps")

par(mfrow =c(2,4))

col <- gray.colors(10, gamma = 1, start = 0, end = 0.8)

pts <- c(2,4,6,8)

sROC.matrix(est2[c(1,2,4,5),  pts])
legend("bottomright", 
       bty='n',
       legend = c(TeX(paste0("$p = 0.9, \\, \\tilde{c}_1^2 =", round(est2[6,2],3), 
                             ",\\, \\tilde{c}_2^2 = ", round(est2[7,2],3), "$")), 
                  TeX(paste0("$p = 0.7, \\, \\tilde{c}_1^2 =", round(est2[6,4],3), 
                             ",\\, \\tilde{c}_2^2 = ", round(est2[7,4],3), "$")), 
                  TeX(paste0("$p = 0.5, \\, \\tilde{c}_1^2 =", round(est2[6,6],3), 
                             ",\\, \\tilde{c}_2^2 = ", round(est2[7,6],3), "$")), 
                  TeX(paste0("$p = 0.3, \\, \\tilde{c}_1^2 =", round(est2[6,8],3), 
                             ",\\, \\tilde{c}_2^2 = ", round(est2[7,8],3), "$"))
                  ),
       col = col[pts], pch = 18, pt.cex = 2,
       lty = rep(1,4))
title("A", adj = 0)
            

sROC.matrix(est11[c(1,2,4,5), pts])
legend("bottomright", 
       bty='n',
       legend = c(TeX("$p = 0.9, \\, c_1^2 = c_2^2$"), 
                  TeX("$p = 0.7, \\, c_1^2 = c_2^2$"), 
                  TeX("$p = 0.5, \\, c_1^2 = c_2^2$"), 
                  TeX("$p = 0.3, \\, c_1^2 = c_2^2$")), 
       col = col[pts], pch = 18, pt.cex = 2,
       lty = rep(1,4))
title("B", adj = 0)

sROC.matrix(est10[c(1,2,4,5), pts])
legend("bottomright", 
       bty='n',
       legend = c(TeX("$p = 0.9, \\, c_1^2 = 1, \\, c_2^2 = 0$"), 
                  TeX("$p = 0.7, \\, c_1^2 = 1, \\, c_2^2 = 0$"), 
                  TeX("$p = 0.5, \\, c_1^2 = 1, \\, c_2^2 = 0$"), 
                  TeX("$p = 0.3, \\, c_1^2 = 1, \\, c_2^2 = 0$")), 
       col = col[pts], pch = 18, pt.cex = 2,
       lty = rep(1,4))
title("C", adj = 0)


sROC.matrix(est01[c(1,2,4,5),pts])
legend("bottomright", 
       bty='n',
       legend = c(TeX("$p = 0.9, \\, c_1^2 = 0, \\, c_2^2 = 1$"), 
                  TeX("$p = 0.7, \\, c_1^2 = 0, \\, c_2^2 = 1$"), 
                  TeX("$p = 0.5, \\, c_1^2 = 0, \\, c_2^2 = 1$"), 
                  TeX("$p = 0.3, \\, c_1^2 = 0, \\, c_2^2 = 1$")), 
       col = col[pts], pch = 18, pt.cex = 2,
       lty = rep(1,4))
title("D", adj = 0)

SAUC2   <- est2[c(10, 13, 14),]
SAUC11  <- est11[c(10, 13, 14),]
SAUC10  <- est10[c(10, 13, 14),]
SAUC01  <- est01[c(10, 13, 14),]


matplot(t(SAUC2), type = "o", lty = c(1,1,1), 
        pch = 19, col = c("black", "grey", "grey"),
        cex = 0.5,
        xlab = "p", ylab = "SAUC",
        ylim = c(0,1),
        xaxt = "n")
axis(1, at = 1:10, labels = p.seq)
title("E", adj = 0)



matplot(t(SAUC11), type = "o", lty = c(1,1,1), 
        pch = 19, col = c("black", "grey", "grey"),
        cex = 0.5,
        xlab = "p", ylab = "SAUC",
        ylim = c(0,1),
        xaxt = "n")
axis(1, at = 1:10, labels = p.seq)
title("F", adj = 0)

matplot(t(SAUC10), type = "o", lty = c(1,1,1), 
        pch = 19, col = c("black", "grey", "grey"),
        cex = 0.5,
        xlab = "p", ylab = "SAUC",
        ylim = c(0,1),
        xaxt = "n")
axis(1, at = 1:10, labels = p.seq)
title("G", adj = 0)

matplot(t(SAUC01), type = "o", lty = c(1,1,1), 
        pch = 19, col = c("black", "grey", "grey"),
        cex = 0.5,
        xlab = "p", ylab = "SAUC",
        ylim = c(0,1),
        xaxt = "n")
axis(1, at = 1:10, labels = p.seq)
title("H", adj = 0)


par(mfrow = c(1,1))

dev.off()
```

\newpage 

### Estimates

```{r}

load("RData/Lym-est.RData")

reform.est <- function(est){
  
colnames(est) <- paste0("p = ", p.seq)
rownames(est)[13:14] <- c("SAUC.ci.lb", "SAUC.ci.ub")

row.n <- c(10, 13,14, 11, 12)
tb <- t(est)

SAUC <- sprintf("%.3f [%.3f, %.3f]", tb[,10],tb[,13], tb[,14]) 
c    <- tb[,6:7]
sep  <- tb[,11:12]

cbind.data.frame(SAUC, c, sep)
}

tb2  <- reform.est(est2)
tb11 <- reform.est(est11)
tb10 <- reform.est(est10)
tb01 <- reform.est(est01)

tb <- cbind(p.seq, tb2, tb11, tb10, tb01)[, -c(8:9, 13:14, 18:19)]

colnames(tb) <- c("p", "SAUC [$95\\%$ CI]", "$c_1^2$", "$c_2^2$", "se", "sp", 
                  rep(c("SAUC [$95\\%$ CI]", "se", "sp"),3))
rownames(tb) <- NULL

sink("tb-lym.tex")
kbl(tb, 
    format = "latex",
    longtable = F, 
    booktabs = T, 
    digits =2,
    align = "r",
    linesep = '',
    escape = FALSE,
    caption = "Lym") %>% 
  add_header_above(c(" ", "Estimated $c_1^2, c_2^2$" = 5, 
                     "$c_1^2 = c_2^2$" = 3, 
                     "$c_1^2 = 1, c_2^2 = 0$" = 3, 
                     "$c_1^2 = 0, c_2^2 = 1$" = 3), escape = FALSE)

sink()
```
